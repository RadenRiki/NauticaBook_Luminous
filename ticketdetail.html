<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles3.css">
    <link rel="stylesheet" href="styles.css">
    <title>Detail Pesanan Tiket - NauticaBook</title>
    <script defer src="script.js"></script>
</head>
<body>
    <!-- Header Section -->
    <div class="header-section">
        <div class="title">Detail Pesanan</div>
        <a href="home.html" class="btn-jadwal">CARI JADWAL LAINNYA</a>
    </div>

    <!-- Container -->
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div>
                <h1 id="route">-</h1>
                <p id="details">-</p>
            </div>
            <div class="price" id="totalPrice">Rp0</div>
        </div>

        <!-- Detail Informasi -->
        <div class="details">
            <p>Jadwal Masuk Pelabuhan</p>
            <p id="schedule" style="font-size: 22px; font-weight: bold; color: #333;">-</p>
            <!-- Tombol Pesan -->
            <div>
                <button class="btn-pesan" id="btnPesan">PESAN TIKET</button>
            </div>
        </div>

        <!-- Tab Menu -->
        <div class="tabs">
            <button class="tab-link active" onclick="openTab(event, 'harga')">Rincian Harga</button>
            <button class="tab-link" onclick="openTab(event, 'kapal')">Daftar Nama Kapal</button>
            <button class="tab-link" onclick="openTab(event, 'policy')">Kebijakan</button>
        </div>

        <!-- Tab Content Rincian Harga -->
        <div id="harga" class="tab-content active">
            <div id="priceDetails"></div>
        </div>

        <!-- Tab Content Daftar Nama Kapal -->
        <div id="kapal" class="tab-content">
            <p class="info-message">
                Nama kapal akan diinformasikan saat tiba di pelabuhan.
            </p>
        </div>

        <!-- Kebijakan -->
        <div id="policy" class="tab-content">
            <p><strong>Kebijakan:</strong></p>
            <ul>
                <li>Kendaraan Over Dimension dan Over Loading (ODOL) tidak diperkenankan memasuki area pelabuhan;</li>
                <li>Anda sudah dapat Masuk Pelabuhan (Check In) mulai dari 2 (dua) jam sebelum jadwal;</li>
                <li>Tiket akan hangus (expired) jika melewati batas waktu Check In;</li>
                <li>Nama Penumpang harus sesuai dengan Kartu Identitas (KTP/SIM/Passport/Dll);</li>
                <li>Jumlah Penumpang dan Nomor Polisi Kendaraan harus sesuai;</li>
                <li>Jadwal keberangkatan dapat berubah sewaktu-waktu mengikuti kondisi cuaca dan operasional.</li>
            </ul>
        </div>
    </div>
    <footer class="footer">
        <div class="section__container footer__container">
            <div class="footer__col">
                <h3>NauticaBook</h3>
                <p>
                    NauticaBook adalah platform untuk booking ferry dan cargo secara cepat dan terpercaya.
                    Pengguna dapat mencari jadwal, membandingkan harga, dan memesan tiket dengan mudah dalam beberapa
                    langkah.
                </p>
                <p>
                    NauticaBook menawarkan antarmuka ramah pengguna untuk pengalaman pemesanan nyaman,
                    baik untuk perjalanan pribadi, bisnis, maupun logistik. Dengan mitra terpercaya,
                    layanan pelanggan responsif, dan sistem pembayaran aman, NauticaBook memenuhi kebutuhan transportasi
                    laut Anda.
                </p>
            </div>
            <div class="footer__col">
                <h4>Tim Luminous</h4>
                <p>Raden Riki Hilviastari Saputra (23523217)</p>
                <p>Arvindra Ahmad Ramadhan (23523128)</p>
                <p> Taqya Maritsa Hakim (23523108)</p>
                <p>-</p>
            </div>
        </div>
        </div>
        <div class="footer__bar">
            Copyright © 2024 Webs by Luminous. All rights reserved.
        </div>
    </footer>


    <script>
      document.addEventListener('DOMContentLoaded', function () {
    const tarif = {
        "merak-bakauheni": {
            regular: {  // Perhatikan perubahan dari 'reguler' ke 'regular'
                "Pejalan Kaki": { 
                    dewasa: 22700, 
                    bayi: 1800,
                    anak: 22700,
                    lansia: 22700 
                },
                "Sepeda": 26500,
                "Motor Kecil": 62100,
                "Motor Besar": 133000,
                "Mobil": 481800  // Sesuaikan dengan tipe tiket dari form
            },
            express: {
                "Pejalan Kaki": { 
                    dewasa: 84000, 
                    bayi: 4000,
                    anak: 84000,
                    lansia: 84000 
                },
                "Sepeda": 85000,
                "Motor Kecil": 129677,
                "Motor Besar": 187853,
                "Mobil": 749128
            }
        },
        "bakauheni-merak": {
            regular: {
                "Pejalan Kaki": { 
                    dewasa: 22700, 
                    bayi: 1800,
                    anak: 22700,
                    lansia: 22700 
                },
                "Sepeda": 26500,
                "Motor Kecil": 62100,
                "Motor Besar": 133000,
                "Mobil": 481800
            },
            express: {
                "Pejalan Kaki": { 
                    dewasa: 84000, 
                    bayi: 4000,
                    anak: 84000,
                    lansia: 84000 
                },
                "Sepeda": 85000,
                "Motor Kecil": 129677,
                "Motor Besar": 187853,
                "Mobil": 749128
            }
        },
        "ketapang-gilimanuk": {
            regular: {
                "Pejalan Kaki": { 
                    dewasa: 10600, 
                    bayi: 1600,
                    anak: 10600,
                    lansia: 10600 
                },
                "Sepeda": 11000,
                "Motor Kecil": 31600,
                "Motor Besar": 45000,
                "Mobil": 213400
            }
        },
        "gilimanuk-ketapang": {
            regular: {
                "Pejalan Kaki": { 
                    dewasa: 10600, 
                    bayi: 1600,
                    anak: 10600,
                    lansia: 10600 
                },
                "Sepeda": 11000,
                "Motor Kecil": 31600,
                "Motor Besar": 45000,
                "Mobil": 213400
            }
        }
    };

    const bookingData = JSON.parse(sessionStorage.getItem('bookingData'));
    if (!bookingData) {
        alert('Data pemesanan tidak tersedia.');
        window.location.href = 'home.html';
        return;
    }

    // Debug log
    console.log('Booking Data:', bookingData);
    
    // Cari rute
    const rute = `${bookingData.pelabuhanAsal}-${bookingData.pelabuhanTujuan}`.toLowerCase();
    console.log('Mencari rute:', rute, 'dengan layanan:', bookingData.layanan);
    console.log('Tipe tiket:', bookingData.tipeTiket);
    
    const tarifLayanan = tarif[rute]?.[bookingData.layanan];
    if (!tarifLayanan) {
        console.error('Tarif tidak ditemukan untuk:', {
            rute: rute,
            layanan: bookingData.layanan,
            tersediaLayanan: Object.keys(tarif[rute] || {})
        });
        alert('Tarif untuk rute ini tidak ditemukan.');
        return;
    }

    // Perhitungan harga
    let totalHarga = 0;
    const priceDetails = [];
    
    if (bookingData.tipeTiket === "Pejalan Kaki") {
        // Hitung untuk setiap jenis penumpang
        const kategori = {
            dewasa: "Dewasa",
            anak: "Anak",
            bayi: "Bayi",
            lansia: "Lansia"
        };

        for (const [type, label] of Object.entries(kategori)) {
            if (bookingData.jumlahPenumpang[type] > 0) {
                const harga = tarifLayanan["Pejalan Kaki"][type];
                const subtotal = harga * bookingData.jumlahPenumpang[type];
                totalHarga += subtotal;
                
                priceDetails.push(`
                    <div class="price-details">
                        <span>${label} x ${bookingData.jumlahPenumpang[type]}</span>
                        <span>Rp${subtotal.toLocaleString()}</span>
                    </div>
                `);
            }
        }
    } else {
        // Untuk kendaraan, harga flat per kendaraan
        const hargaKendaraan = tarifLayanan[bookingData.tipeTiket];
        totalHarga = hargaKendaraan;
        
        priceDetails.push(`
            <div class="price-details">
                <span>${bookingData.tipeTiket}</span>
                <span>Rp${hargaKendaraan.toLocaleString()}</span>
            </div>
        `);
    }

    // Update UI
    document.getElementById("route").textContent = 
        `${bookingData.pelabuhanAsal.toUpperCase()} → ${bookingData.pelabuhanTujuan.toUpperCase()}`;
    
    const totalPenumpang = bookingData.jumlahPenumpang.total;
    
    document.getElementById("details").textContent = 
        `${bookingData.layanan.toUpperCase()} · ${totalPenumpang} Penumpang`;
    
    document.getElementById("schedule").textContent = 
        `${new Date(bookingData.tanggal).toLocaleDateString('id-ID', { 
            weekday: 'long', 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        })}`;

        let formatedDate = new Date(bookingData.tanggal).toLocaleDateString('id-ID', { 
          weekday: 'long', 
          year: 'numeric', 
          month: 'long', 
          day: 'numeric' 
        });
        
        let jam = bookingData.jamMasuk; // jam "06:00" misalnya
        
        document.getElementById("schedule").textContent =
          `${formatedDate} | Jam Masuk: ${jam} WIB`;
        

    document.getElementById("priceDetails").innerHTML = priceDetails.join('');
    document.getElementById("totalPrice").textContent = `Rp${totalHarga.toLocaleString()}`;

    // Tombol Pesan
    document.getElementById('btnPesan').addEventListener('click', function () {
        sessionStorage.setItem('totalPrice', totalHarga);

        // Misalkan data jumlah penumpang di bookingData.jumlahPenumpang
        const { dewasa, anak, bayi, lansia } = bookingData.jumlahPenumpang;

        // Buat array penumpangData
        const penumpangData = [];

        // Masukkan sekian banyak "objek penumpang" (masih bisa diisi apa pun)
        for (let i = 0; i < dewasa; i++) {
          penumpangData.push({ category: 'Dewasa' });
        }
        for (let i = 0; i < anak; i++) {
          penumpangData.push({ category: 'Anak' });
        }
        for (let i = 0; i < bayi; i++) {
          penumpangData.push({ category: 'Bayi' });
        }
        for (let i = 0; i < lansia; i++) {
          penumpangData.push({ category: 'Lansia' });
        }

        // Simpan array ini di sessionStorage
        sessionStorage.setItem('penumpangData', JSON.stringify(penumpangData));
        sessionStorage.setItem('bookingData', JSON.stringify(bookingData)); 
        // agar rute, jam, tanggal, layanan dsb. bisa ditampilkan ulang di booking_form.html

        sessionStorage.setItem('totalPrice', totalHarga);

        sessionStorage.setItem('tipeTiket', bookingData.tipeTiket); 
        // Contoh: "Mobil", "Pejalan Kaki", "Motor Kecil", dll

        window.location.href = 'booking_form.html';
        });
    });
  </script>  
</body>
</html>
